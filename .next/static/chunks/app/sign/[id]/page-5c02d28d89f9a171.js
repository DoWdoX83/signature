(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[656],{4472:(e,t,n)=>{Promise.resolve().then(n.bind(n,4861))},4861:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(5155),l=n(7260),i=n(2115),a=n(6785);function s(){let e=(0,l.useParams)(),t=(0,l.useRouter)(),n=null==e?void 0:e.id,s=(0,i.useRef)(null),[u,o]=(0,i.useState)(!1),[c,d]=(0,i.useState)(null),h=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=h.current;if(!e)return;let t=new ResizeObserver(()=>{window.dispatchEvent(new Event("resize"))});return t.observe(e),()=>t.disconnect()},[]);let g=(0,i.useCallback)(()=>{var e;null==(e=s.current)||e.clear()},[]),f=(0,i.useCallback)(async()=>{if(!s.current||s.current.isEmpty())return void d("Veuillez signer avant d'enregistrer.");d(null),o(!0);try{let e=s.current.getCanvas?s.current.getCanvas():null,r=e?(()=>{let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");return n&&n.drawImage(e,0,0),function(e){let t=e.getContext("2d");if(!t)return e;let{width:n,height:r}=e,l=t.getImageData(0,0,n,r).data,i=null,a=null,s=null,u=null;for(let e=0;e<r;e++)for(let t=0;t<n;t++)0!==l[(e*n+t)*4+3]&&(null===i&&(i=e),(null===a||t<a)&&(a=t),(null===s||t>s)&&(s=t),u=e);if(null===i||null===a||null===s||null===u)return e;let o=s-a+1,c=u-i+1,d=document.createElement("canvas");d.width=o,d.height=c;let h=d.getContext("2d");return h?(h.drawImage(e,a,i,o,c,0,0,o,c),d):e}(t)})():s.current.getTrimmedCanvas?s.current.getTrimmedCanvas():(s.current.toDataURL,null),l=r?r.toDataURL("image/png"):s.current.toDataURL?s.current.toDataURL("image/png"):"",i=await fetch("/api/sign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,signatureDataUrl:l})});if(!i.ok)throw Error("Erreur");await i.json(),t.push("/view/".concat(n))}catch(e){d("\xc9chec de l'enregistrement")}finally{o(!1)}},[n,t]);return(0,r.jsxs)("div",{style:{padding:16,display:"flex",flexDirection:"column",gap:12,height:"100vh",overflow:"hidden"},children:[(0,r.jsx)("h1",{children:"Signer le document"}),(0,r.jsxs)("p",{children:["ID: ",n]}),(0,r.jsx)("div",{ref:h,style:{border:"1px solid #ccc",borderRadius:8,flex:1,width:"100%",minHeight:200,position:"relative",overflow:"hidden"},children:(0,r.jsx)(a.A,{ref:e=>{s.current=e},canvasProps:{style:{width:"100%",height:"100%",position:"absolute",inset:0,display:"block",touchAction:"none"}},penColor:"#000",backgroundColor:"#fff"})}),c&&(0,r.jsx)("p",{style:{color:"red"},children:c}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,flex:"0 0 auto"},children:[(0,r.jsx)("button",{onClick:g,className:"cursor-pointer",children:"Effacer"}),(0,r.jsx)("button",{onClick:f,disabled:u,children:u?"Enregistrement...":"Enregistrer"})]})]})}}},e=>{e.O(0,[785,441,255,358],()=>e(e.s=4472)),_N_E=e.O()}]);